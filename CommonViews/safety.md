# Безопасность
Безопасность - краеугольный камень нашей системы. Не имея особой надежды на прибыль, можно неплохо так сесть в лужу. Потому - максимум усилий на недопущение бардака.

# Общее
1. Права для каждого элемента системы определяются отдельно в специальной таблице Rights. Например, для чата для каждой комнаты есть таблица с пользователями и их правами (обычный, забанет, модератор, администратор). 
2. Каждый запрос к каждому сервису жолжен поступать только доверенными путями. Если вдруг сервис форума начнет спрашивать права для чата - это явно бардак и отдавать такие данные не надо.
3. Все пути только шифрованно. Никаких запросов в открытом виде.
4. У каждого сервиса свои авторизационные и аутентификационные данные. Пароли сервисов менять каждые 1-2 недели. На всякий случай.
5. Для сервисов - паророли не менее 32 символов. Разноплановых. Для пользователей - 8. С регистрами, цифрами, символами. 

# Аутентификация пользователей
![Схема аутентификации](/Images/Securty/security.png "Схема аутентификации")
1. Пользователь вводит логине и пароль в приложение.
2. Приложение кеширует пароль, добавляет куки, заголовки и т.д., позволяющие однозначно идетифицировать этот запрос как запрос с приложения. Например, генерирумый по особому алгоритму токен на 1 сессию. Так же решает проблема пароля в открытом виде. 
3. Естественно, толлько https, все закрыто. 
4. Серверная часть получяает запрос на НУЖНЫЙ GateWay Api, проверяет, что запрос приходит именно с приложения. Дорисовывает заголовки, что запрос пришел правильный и идет через GateWay Api.
5. Сервис User проверяет, что запрос на АУТЕНТИФИКАЦИЮ пришел именно через GateWay Api, изнутри никто такого спрашивать не может. Проверяет у БД наличие логина-пароля. Получаем ответ с откзом или Пользователя. 
    1. Как усиление защиты можно уточнить соответствие пришедших устройства, ОС, локации записи в БД. При серьезном различии стоит уточнить у Пользователя, например, подтверждение через телефон или email... Но на начальном этапе не критично.
    2. Помним наличие поля "isManager". Черз приложение при положительном значении авторизоваться не получится.
6. БД User так же внимательно смотрит, кто к ней обращется. Принимать запросы только от User и накого иначе. 
7. В итоге Приложение получет Пользователя, либо ошибку. Если пользователь - отображает данные из кеша и отправляет запросы на обновление. Ну или дефолтные элементы, если кеша нет. В любом случае, пользователь может работать.

